# Xiaomi NoteBook Pro твики

Множество улучшений на уровне BIOS для этого замечательного ноутбука

[English](README.md) | [Rus](README-RU.md)

## Возможности

* Создание пользовательского профайла для работы системы охлаждения
* Решение проблемы скачущей зарядки при использовании UBS-C хаба и 603 BIOS
* Влючение управления питанием процессора для 502 и 603 BIOS
* Создание пользовательского профайла TDP
* Включение Intel SpeedShift Technology (SST)
* для хакинтошников: изменение параметра DVMT 
* для хакинтошников: 0xE2 Lock 

## В планах

* Настраиваемый порог выключения подсветки клавиатуры

## Credits

- [PavelLJ](https://github.com/PavelLJ) за помощь в разработке
- [saltukkos](https://github.com/saltukkos) за GUI программу для построения собственного профиля работы системы охлаждения

## Установка своего профайла кулеров
Ваша версия BIOS должна быть XMAKB5R0P0603! Обновите если необходимо.
По умолчанию прошивается версия на +12°, если вам нужна версия +20°, замените ec604.bin на соответствующий из папки EC.
Если вам нужна возможность заряжать ноутбук через хаб, используйте папку EC502.
Если вы хотите создать свой собственный профайл, возьмите оригинальный файл EC из папки EC/Orig или EC502/Orig и отредактируйте при помощи https://github.com/saltukkos/xiaomi-notebook-pro-bios-patcher/releases

0. Сделать дамп своей прошивки BIOS: backup.cmd, сохранить вне ноутбука файл mybackup.bin
1. Снять защиту с записи в BIOS: bios_unlock.cmd, обязательно перезагрузиться
2. Сохранить свой EC: readEC.cmd, появится файл ec.bin, это ваш бекап EC
3. Прошить новый EC: flashEC.cmd, будет прошит ec604.bin
4. Сначала вытащить кабель питания, затем полностью выключить ноутбук (Пуск->Завершение работы, а не просто закрыть крышку), подождать минуту, вставить кабель, подождать 5 секунд, включить ноутбук
5. Поставить обратно защиту на BIOS: bios_lock.cmd, перезагрузиться

## Возможные ошибки и их устранения
1) Утилита создания дампа прошивки сообщает:
Error 318: The host CPU does not have read access to the target flash area. To enable read access for this operation you must modify the descriptor settings to give host access to this region.
FPT Operation Failed.
Решение:
- необходимо хотя бы раз проделать процедуру обновления BIOS, до шага "unlockme" включительно, после этого процедуру можно прервать

2) Проблемы политик безопасности и невозможность запуска скриптов PowerShell, например:
"Файл .\patchscript_bue.ps1 не имеет цифровой подписи. Невозможно выполнить сценарий в указанной системе"
Решения:
- ввести в командной строке от администратора: powershell set-executionpolicy remotesigned
- в более запущенных случаях, в групповых политиках безопасности необходимо разрешить выполнение сценариев для powershell

3) Кулеры после патча все равно включаются при температуре 42°
- проверьте что прошивка удалась: запустите еще раз readEC.cmd, сравните ec.bin и ec604.bin, теперь они должны быть полностью идентичны
- попробуйте повторить шаг №4, иногда требуется передергивать кабель несколько раз (почти всегда больше одного)
- отсоединить кабель, долго держать кнопку питания пока ноут не выключится, подождать минуту, подключить кабель, подождать 10 сек, включить
- если все равно не получилось, остается только скинуть шлейф батареи на пару минут, или просто ждать, рано или поздно ЕС считает свою программу сам, после одной из перезагрузок или после ночного сна

## Способы откатиться обратно на сток
1. Прошить стоковый BIOS
2. Прошить обратно только ЕС из своего сохраненного файла ec.bin, по инструкции выше, также оригинальный файл (он у всех одинаковый) есть в архиве (EC\Orig\ec603.bin)

## Установка остальных твиков
* Влючение управления питанием процессора для 502 и 603 BIOS: запустите скрипт voltage_unlock.cmd
* Создание пользовательского профайла TDP: отредактируйте и запустите скрипт TDP_set.cmd
* Включение Intel SpeedShift Technology (SST): запустите скрипт speedshift_unlock.cmd
* для хакинтошников: изменение параметра DVMT: отредактируйте и запустите скрипт DVMT_set.cmd
* для хакинтошников: 0xE2 Lock: запустите скрипт CFG_unlock.cmd
